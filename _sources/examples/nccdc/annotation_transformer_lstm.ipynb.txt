{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Sequence Annotation with Transformer"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "The autoreload extension is already loaded. To reload it, use:\n",
      "  %reload_ext autoreload\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "from pathlib import Path\n",
    "from icecream import install\n",
    "install()\n",
    "\n",
    "LOCALS = ['NVD4K9M6K4', 'x1']\n",
    "import socket\n",
    "hostname = socket.gethostname()\n",
    "IS_LOCAL = hostname in LOCALS\n",
    "def view_df(data: pd.DataFrame):\n",
    "    pd.set_option('display.max_columns', None)\n",
    "    display(data)\n",
    "    pd.reset_option(\"max_columns\")\n",
    "\n",
    "impact_path = Path('./data/')\n",
    "processed_data_path = impact_path / 'processed-data.csv'\n",
    "label_data_path = impact_path / 'label-data.csv'\n",
    "\n",
    "if IS_LOCAL:\n",
    "    %load_ext autoreload\n",
    "    %autoreload 2"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Parameters"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "tags": [
     "parameters"
    ]
   },
   "outputs": [],
   "source": [
    "model_name = \"lstm\" # \"transformer\", \"lstm\""
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Load data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "import random\n",
    "# nrows= 100000 if IS_LOCAL else None\n",
    "# n = 19433497-1\n",
    "n = 19433497\n",
    "s = 100000\n",
    "skip = sorted(random.sample(range(1, n+1), n-s)) if IS_LOCAL else None\n",
    "input = pd.read_csv(\n",
    "    processed_data_path, index_col='index',\n",
    "    dtype={\n",
    "        'protocol': 'string',\n",
    "        'rootId': 'string',\n",
    "        # 'source.port': str,\n",
    "        # 'destination.port': str,\n",
    "    },\n",
    "    skiprows=skip if IS_LOCAL else None,\n",
    "    # nrows=s,\n",
    ")\n",
    "label = pd.read_csv(\n",
    "    label_data_path, \n",
    "    index_col='index',\n",
    "    # dtype={\n",
    "    #     'is_multicast': bool,\n",
    "    #     'is_private': bool,\n",
    "    #     'is_global': bool,\n",
    "    #     'is_unspecified': bool,\n",
    "    #     'is_reserved': bool,\n",
    "    #     'is_loopback': bool,\n",
    "    #     'is_link_local': bool\n",
    "    # },\n",
    "    skiprows=skip if IS_LOCAL else None,\n",
    "    # nrows=s,\n",
    ")\n",
    "\n",
    "label = label.drop(['source.ip'], axis=1)\n",
    "data = input\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Feature Engineering"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>firstPacket</th>\n",
       "      <th>lastPacket</th>\n",
       "      <th>ipProtocol</th>\n",
       "      <th>protocol</th>\n",
       "      <th>rootId</th>\n",
       "      <th>totDataBytes</th>\n",
       "      <th>client.bytes</th>\n",
       "      <th>server.bytes</th>\n",
       "      <th>source.ip</th>\n",
       "      <th>source.port</th>\n",
       "      <th>destination.ip</th>\n",
       "      <th>destination.port</th>\n",
       "      <th>network.packets</th>\n",
       "      <th>source.packets</th>\n",
       "      <th>destination.packets</th>\n",
       "      <th>network.bytes</th>\n",
       "      <th>source.bytes</th>\n",
       "      <th>destination.bytes</th>\n",
       "      <th>node</th>\n",
       "      <th>http.uri</th>\n",
       "      <th>source.geo.country_iso_code</th>\n",
       "      <th>destination.geo.country_iso_code</th>\n",
       "      <th>dns.host</th>\n",
       "      <th>cert</th>\n",
       "      <th>irc.channel</th>\n",
       "      <th>http.xffGEO</th>\n",
       "      <th>time_idx</th>\n",
       "      <th>time_from_start_to_last_packet</th>\n",
       "      <th>time_from_start_to_first_packet</th>\n",
       "      <th>time_idx_nogap</th>\n",
       "      <th>hour</th>\n",
       "      <th>minute</th>\n",
       "      <th>second</th>\n",
       "      <th>microsecond</th>\n",
       "      <th>hour_sin</th>\n",
       "      <th>hour_cos</th>\n",
       "      <th>minute_sin</th>\n",
       "      <th>minute_cos</th>\n",
       "      <th>second_sin</th>\n",
       "      <th>second_cos</th>\n",
       "      <th>microsecond_sin</th>\n",
       "      <th>microsecond_cos</th>\n",
       "      <th>has_cert</th>\n",
       "      <th>has_dns_host</th>\n",
       "      <th>group_id</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>index</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>481</th>\n",
       "      <td>2016-04-22 14:00:04.917</td>\n",
       "      <td>2016-04-22 14:00:04.917</td>\n",
       "      <td>6</td>\n",
       "      <td>[tcp]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>10.120.0.31</td>\n",
       "      <td>38675</td>\n",
       "      <td>10.20.20.20</td>\n",
       "      <td>22</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>130</td>\n",
       "      <td>66</td>\n",
       "      <td>64</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4347</td>\n",
       "      <td>4.347</td>\n",
       "      <td>4.347</td>\n",
       "      <td>0</td>\n",
       "      <td>14</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>917000</td>\n",
       "      <td>-6.310879e-01</td>\n",
       "      <td>-0.775711</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.413212</td>\n",
       "      <td>0.910635</td>\n",
       "      <td>-0.493176</td>\n",
       "      <td>0.869930</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>641</th>\n",
       "      <td>2016-04-22 14:00:06.887</td>\n",
       "      <td>2016-04-22 14:00:06.887</td>\n",
       "      <td>6</td>\n",
       "      <td>[tcp]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>10.120.0.31</td>\n",
       "      <td>50859</td>\n",
       "      <td>10.20.20.1</td>\n",
       "      <td>22</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>66</td>\n",
       "      <td>66</td>\n",
       "      <td>0</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>6317</td>\n",
       "      <td>6.317</td>\n",
       "      <td>6.317</td>\n",
       "      <td>1</td>\n",
       "      <td>14</td>\n",
       "      <td>0</td>\n",
       "      <td>6</td>\n",
       "      <td>887000</td>\n",
       "      <td>-6.310879e-01</td>\n",
       "      <td>-0.775711</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.596367</td>\n",
       "      <td>0.802712</td>\n",
       "      <td>-0.647593</td>\n",
       "      <td>0.761987</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1012</th>\n",
       "      <td>2016-04-22 14:00:12.663</td>\n",
       "      <td>2016-04-22 14:00:12.675</td>\n",
       "      <td>6</td>\n",
       "      <td>[tcp tls]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>4358</td>\n",
       "      <td>598</td>\n",
       "      <td>3760</td>\n",
       "      <td>10.222.223.121</td>\n",
       "      <td>50318</td>\n",
       "      <td>192.168.2.6</td>\n",
       "      <td>443</td>\n",
       "      <td>19</td>\n",
       "      <td>9</td>\n",
       "      <td>10</td>\n",
       "      <td>5692</td>\n",
       "      <td>1236</td>\n",
       "      <td>4456</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[]</td>\n",
       "      <td>[{'issuerCN': [\"let's encrypt authority x1\"], ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>12105</td>\n",
       "      <td>12.105</td>\n",
       "      <td>12.093</td>\n",
       "      <td>2</td>\n",
       "      <td>14</td>\n",
       "      <td>0</td>\n",
       "      <td>12</td>\n",
       "      <td>675000</td>\n",
       "      <td>-6.310879e-01</td>\n",
       "      <td>-0.775711</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.957422</td>\n",
       "      <td>0.288692</td>\n",
       "      <td>-0.892926</td>\n",
       "      <td>-0.450204</td>\n",
       "      <td>True</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1540</th>\n",
       "      <td>2016-04-22 14:00:22.709</td>\n",
       "      <td>2016-04-22 14:00:22.709</td>\n",
       "      <td>17</td>\n",
       "      <td>[dns udp]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>78</td>\n",
       "      <td>31</td>\n",
       "      <td>47</td>\n",
       "      <td>10.222.44.23</td>\n",
       "      <td>36222</td>\n",
       "      <td>192.168.2.10</td>\n",
       "      <td>53</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>170</td>\n",
       "      <td>77</td>\n",
       "      <td>93</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[traphouse.net]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>22139</td>\n",
       "      <td>22.139</td>\n",
       "      <td>22.139</td>\n",
       "      <td>3</td>\n",
       "      <td>14</td>\n",
       "      <td>0</td>\n",
       "      <td>22</td>\n",
       "      <td>709000</td>\n",
       "      <td>-6.310879e-01</td>\n",
       "      <td>-0.775711</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.716457</td>\n",
       "      <td>-0.697632</td>\n",
       "      <td>-0.968128</td>\n",
       "      <td>-0.250456</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1561</th>\n",
       "      <td>2016-04-22 14:00:23.140</td>\n",
       "      <td>2016-04-22 14:00:23.140</td>\n",
       "      <td>6</td>\n",
       "      <td>[tcp]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>10.160.110.240</td>\n",
       "      <td>46440</td>\n",
       "      <td>10.10.36.113</td>\n",
       "      <td>445</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>64</td>\n",
       "      <td>64</td>\n",
       "      <td>0</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>22570</td>\n",
       "      <td>22.570</td>\n",
       "      <td>22.570</td>\n",
       "      <td>4</td>\n",
       "      <td>14</td>\n",
       "      <td>0</td>\n",
       "      <td>23</td>\n",
       "      <td>140000</td>\n",
       "      <td>-6.310879e-01</td>\n",
       "      <td>-0.775711</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.638244</td>\n",
       "      <td>-0.769834</td>\n",
       "      <td>0.771074</td>\n",
       "      <td>0.636745</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19432876</th>\n",
       "      <td>2016-04-22 23:28:21.733</td>\n",
       "      <td>2016-04-22 23:28:22.233</td>\n",
       "      <td>6</td>\n",
       "      <td>[http tcp]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>486</td>\n",
       "      <td>370</td>\n",
       "      <td>116</td>\n",
       "      <td>172.16.20.202</td>\n",
       "      <td>62298</td>\n",
       "      <td>10.200.211.212</td>\n",
       "      <td>80</td>\n",
       "      <td>10</td>\n",
       "      <td>5</td>\n",
       "      <td>5</td>\n",
       "      <td>1106</td>\n",
       "      <td>670</td>\n",
       "      <td>436</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>['10.200.211.212/load']</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>34101663</td>\n",
       "      <td>34101.663</td>\n",
       "      <td>34101.163</td>\n",
       "      <td>99995</td>\n",
       "      <td>23</td>\n",
       "      <td>28</td>\n",
       "      <td>22</td>\n",
       "      <td>233000</td>\n",
       "      <td>-2.449294e-16</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.159063</td>\n",
       "      <td>-0.987268</td>\n",
       "      <td>0.716457</td>\n",
       "      <td>-0.697632</td>\n",
       "      <td>0.994456</td>\n",
       "      <td>0.105154</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19433035</th>\n",
       "      <td>2016-04-22 23:28:22.695</td>\n",
       "      <td>2016-04-22 23:28:22.698</td>\n",
       "      <td>6</td>\n",
       "      <td>[http tcp]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>484</td>\n",
       "      <td>368</td>\n",
       "      <td>116</td>\n",
       "      <td>10.20.20.201</td>\n",
       "      <td>49176</td>\n",
       "      <td>10.200.80.141</td>\n",
       "      <td>80</td>\n",
       "      <td>9</td>\n",
       "      <td>5</td>\n",
       "      <td>4</td>\n",
       "      <td>1060</td>\n",
       "      <td>688</td>\n",
       "      <td>372</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>['10.200.80.141/ptj']</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>34102128</td>\n",
       "      <td>34102.128</td>\n",
       "      <td>34102.125</td>\n",
       "      <td>99996</td>\n",
       "      <td>23</td>\n",
       "      <td>28</td>\n",
       "      <td>22</td>\n",
       "      <td>698000</td>\n",
       "      <td>-2.449294e-16</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.159063</td>\n",
       "      <td>-0.987268</td>\n",
       "      <td>0.716457</td>\n",
       "      <td>-0.697632</td>\n",
       "      <td>-0.948498</td>\n",
       "      <td>-0.316783</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19433233</th>\n",
       "      <td>2016-04-22 23:28:24.096</td>\n",
       "      <td>2016-04-22 23:28:24.099</td>\n",
       "      <td>6</td>\n",
       "      <td>[http tcp]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>482</td>\n",
       "      <td>366</td>\n",
       "      <td>116</td>\n",
       "      <td>172.16.20.205</td>\n",
       "      <td>2966</td>\n",
       "      <td>10.200.16.224</td>\n",
       "      <td>80</td>\n",
       "      <td>10</td>\n",
       "      <td>5</td>\n",
       "      <td>5</td>\n",
       "      <td>1094</td>\n",
       "      <td>662</td>\n",
       "      <td>432</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>['10.200.16.224/activity']</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>34103529</td>\n",
       "      <td>34103.529</td>\n",
       "      <td>34103.526</td>\n",
       "      <td>99997</td>\n",
       "      <td>23</td>\n",
       "      <td>28</td>\n",
       "      <td>24</td>\n",
       "      <td>99000</td>\n",
       "      <td>-2.449294e-16</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.159063</td>\n",
       "      <td>-0.987268</td>\n",
       "      <td>0.552800</td>\n",
       "      <td>-0.833314</td>\n",
       "      <td>0.583196</td>\n",
       "      <td>0.812331</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19433337</th>\n",
       "      <td>2016-04-22 23:28:24.658</td>\n",
       "      <td>2016-04-22 23:28:24.661</td>\n",
       "      <td>6</td>\n",
       "      <td>[http tcp]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>705</td>\n",
       "      <td>556</td>\n",
       "      <td>149</td>\n",
       "      <td>10.60.60.201</td>\n",
       "      <td>62470</td>\n",
       "      <td>10.200.153.148</td>\n",
       "      <td>80</td>\n",
       "      <td>8</td>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "      <td>1217</td>\n",
       "      <td>812</td>\n",
       "      <td>405</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>['10.200.153.148/images/iaobijnbihnpfgnhnofaac...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>34104091</td>\n",
       "      <td>34104.091</td>\n",
       "      <td>34104.088</td>\n",
       "      <td>99998</td>\n",
       "      <td>23</td>\n",
       "      <td>28</td>\n",
       "      <td>24</td>\n",
       "      <td>661000</td>\n",
       "      <td>-2.449294e-16</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.159063</td>\n",
       "      <td>-0.987268</td>\n",
       "      <td>0.552800</td>\n",
       "      <td>-0.833314</td>\n",
       "      <td>-0.849876</td>\n",
       "      <td>-0.526983</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19433393</th>\n",
       "      <td>2016-04-22 23:28:25.119</td>\n",
       "      <td>2016-04-22 23:28:25.119</td>\n",
       "      <td>17</td>\n",
       "      <td>[udp]</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>50</td>\n",
       "      <td>50</td>\n",
       "      <td>0</td>\n",
       "      <td>10.20.20.106</td>\n",
       "      <td>137</td>\n",
       "      <td>10.20.20.255</td>\n",
       "      <td>137</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>96</td>\n",
       "      <td>96</td>\n",
       "      <td>0</td>\n",
       "      <td>cma-arkime</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>34104549</td>\n",
       "      <td>34104.549</td>\n",
       "      <td>34104.549</td>\n",
       "      <td>99999</td>\n",
       "      <td>23</td>\n",
       "      <td>28</td>\n",
       "      <td>25</td>\n",
       "      <td>119000</td>\n",
       "      <td>-2.449294e-16</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.159063</td>\n",
       "      <td>-0.987268</td>\n",
       "      <td>0.461093</td>\n",
       "      <td>-0.887352</td>\n",
       "      <td>0.680502</td>\n",
       "      <td>0.732746</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>x</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>100000 rows × 45 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                     firstPacket              lastPacket  ipProtocol  \\\n",
       "index                                                                  \n",
       "481      2016-04-22 14:00:04.917 2016-04-22 14:00:04.917           6   \n",
       "641      2016-04-22 14:00:06.887 2016-04-22 14:00:06.887           6   \n",
       "1012     2016-04-22 14:00:12.663 2016-04-22 14:00:12.675           6   \n",
       "1540     2016-04-22 14:00:22.709 2016-04-22 14:00:22.709          17   \n",
       "1561     2016-04-22 14:00:23.140 2016-04-22 14:00:23.140           6   \n",
       "...                          ...                     ...         ...   \n",
       "19432876 2016-04-22 23:28:21.733 2016-04-22 23:28:22.233           6   \n",
       "19433035 2016-04-22 23:28:22.695 2016-04-22 23:28:22.698           6   \n",
       "19433233 2016-04-22 23:28:24.096 2016-04-22 23:28:24.099           6   \n",
       "19433337 2016-04-22 23:28:24.658 2016-04-22 23:28:24.661           6   \n",
       "19433393 2016-04-22 23:28:25.119 2016-04-22 23:28:25.119          17   \n",
       "\n",
       "            protocol rootId  totDataBytes  client.bytes  server.bytes  \\\n",
       "index                                                                   \n",
       "481            [tcp]   <NA>             0             0             0   \n",
       "641            [tcp]   <NA>             0             0             0   \n",
       "1012       [tcp tls]   <NA>          4358           598          3760   \n",
       "1540       [dns udp]   <NA>            78            31            47   \n",
       "1561           [tcp]   <NA>             0             0             0   \n",
       "...              ...    ...           ...           ...           ...   \n",
       "19432876  [http tcp]   <NA>           486           370           116   \n",
       "19433035  [http tcp]   <NA>           484           368           116   \n",
       "19433233  [http tcp]   <NA>           482           366           116   \n",
       "19433337  [http tcp]   <NA>           705           556           149   \n",
       "19433393       [udp]   <NA>            50            50             0   \n",
       "\n",
       "               source.ip  source.port  destination.ip  destination.port  \\\n",
       "index                                                                     \n",
       "481          10.120.0.31        38675     10.20.20.20                22   \n",
       "641          10.120.0.31        50859      10.20.20.1                22   \n",
       "1012      10.222.223.121        50318     192.168.2.6               443   \n",
       "1540        10.222.44.23        36222    192.168.2.10                53   \n",
       "1561      10.160.110.240        46440    10.10.36.113               445   \n",
       "...                  ...          ...             ...               ...   \n",
       "19432876   172.16.20.202        62298  10.200.211.212                80   \n",
       "19433035    10.20.20.201        49176   10.200.80.141                80   \n",
       "19433233   172.16.20.205         2966   10.200.16.224                80   \n",
       "19433337    10.60.60.201        62470  10.200.153.148                80   \n",
       "19433393    10.20.20.106          137    10.20.20.255               137   \n",
       "\n",
       "          network.packets  source.packets  destination.packets  network.bytes  \\\n",
       "index                                                                           \n",
       "481                     2               1                    1            130   \n",
       "641                     1               1                    0             66   \n",
       "1012                   19               9                   10           5692   \n",
       "1540                    2               1                    1            170   \n",
       "1561                    1               1                    0             64   \n",
       "...                   ...             ...                  ...            ...   \n",
       "19432876               10               5                    5           1106   \n",
       "19433035                9               5                    4           1060   \n",
       "19433233               10               5                    5           1094   \n",
       "19433337                8               4                    4           1217   \n",
       "19433393                1               1                    0             96   \n",
       "\n",
       "          source.bytes  destination.bytes        node  \\\n",
       "index                                                   \n",
       "481                 66                 64  cma-arkime   \n",
       "641                 66                  0  cma-arkime   \n",
       "1012              1236               4456  cma-arkime   \n",
       "1540                77                 93  cma-arkime   \n",
       "1561                64                  0  cma-arkime   \n",
       "...                ...                ...         ...   \n",
       "19432876           670                436  cma-arkime   \n",
       "19433035           688                372  cma-arkime   \n",
       "19433233           662                432  cma-arkime   \n",
       "19433337           812                405  cma-arkime   \n",
       "19433393            96                  0  cma-arkime   \n",
       "\n",
       "                                                   http.uri  \\\n",
       "index                                                         \n",
       "481                                                     NaN   \n",
       "641                                                     NaN   \n",
       "1012                                                    NaN   \n",
       "1540                                                    NaN   \n",
       "1561                                                    NaN   \n",
       "...                                                     ...   \n",
       "19432876                            ['10.200.211.212/load']   \n",
       "19433035                              ['10.200.80.141/ptj']   \n",
       "19433233                         ['10.200.16.224/activity']   \n",
       "19433337  ['10.200.153.148/images/iaobijnbihnpfgnhnofaac...   \n",
       "19433393                                                NaN   \n",
       "\n",
       "         source.geo.country_iso_code destination.geo.country_iso_code  \\\n",
       "index                                                                   \n",
       "481                              NaN                              NaN   \n",
       "641                              NaN                              NaN   \n",
       "1012                             NaN                              NaN   \n",
       "1540                             NaN                              NaN   \n",
       "1561                             NaN                              NaN   \n",
       "...                              ...                              ...   \n",
       "19432876                         NaN                              NaN   \n",
       "19433035                         NaN                              NaN   \n",
       "19433233                         NaN                              NaN   \n",
       "19433337                         NaN                              NaN   \n",
       "19433393                         NaN                              NaN   \n",
       "\n",
       "                 dns.host                                               cert  \\\n",
       "index                                                                          \n",
       "481                    []                                                NaN   \n",
       "641                    []                                                NaN   \n",
       "1012                   []  [{'issuerCN': [\"let's encrypt authority x1\"], ...   \n",
       "1540      [traphouse.net]                                                NaN   \n",
       "1561                   []                                                NaN   \n",
       "...                   ...                                                ...   \n",
       "19432876               []                                                NaN   \n",
       "19433035               []                                                NaN   \n",
       "19433233               []                                                NaN   \n",
       "19433337               []                                                NaN   \n",
       "19433393               []                                                NaN   \n",
       "\n",
       "          irc.channel http.xffGEO  time_idx  time_from_start_to_last_packet  \\\n",
       "index                                                                         \n",
       "481               NaN         NaN      4347                           4.347   \n",
       "641               NaN         NaN      6317                           6.317   \n",
       "1012              NaN         NaN     12105                          12.105   \n",
       "1540              NaN         NaN     22139                          22.139   \n",
       "1561              NaN         NaN     22570                          22.570   \n",
       "...               ...         ...       ...                             ...   \n",
       "19432876          NaN         NaN  34101663                       34101.663   \n",
       "19433035          NaN         NaN  34102128                       34102.128   \n",
       "19433233          NaN         NaN  34103529                       34103.529   \n",
       "19433337          NaN         NaN  34104091                       34104.091   \n",
       "19433393          NaN         NaN  34104549                       34104.549   \n",
       "\n",
       "          time_from_start_to_first_packet  time_idx_nogap  hour  minute  \\\n",
       "index                                                                     \n",
       "481                                 4.347               0    14       0   \n",
       "641                                 6.317               1    14       0   \n",
       "1012                               12.093               2    14       0   \n",
       "1540                               22.139               3    14       0   \n",
       "1561                               22.570               4    14       0   \n",
       "...                                   ...             ...   ...     ...   \n",
       "19432876                        34101.163           99995    23      28   \n",
       "19433035                        34102.125           99996    23      28   \n",
       "19433233                        34103.526           99997    23      28   \n",
       "19433337                        34104.088           99998    23      28   \n",
       "19433393                        34104.549           99999    23      28   \n",
       "\n",
       "          second  microsecond      hour_sin  hour_cos  minute_sin  minute_cos  \\\n",
       "index                                                                           \n",
       "481            4       917000 -6.310879e-01 -0.775711    0.000000    1.000000   \n",
       "641            6       887000 -6.310879e-01 -0.775711    0.000000    1.000000   \n",
       "1012          12       675000 -6.310879e-01 -0.775711    0.000000    1.000000   \n",
       "1540          22       709000 -6.310879e-01 -0.775711    0.000000    1.000000   \n",
       "1561          23       140000 -6.310879e-01 -0.775711    0.000000    1.000000   \n",
       "...          ...          ...           ...       ...         ...         ...   \n",
       "19432876      22       233000 -2.449294e-16  1.000000    0.159063   -0.987268   \n",
       "19433035      22       698000 -2.449294e-16  1.000000    0.159063   -0.987268   \n",
       "19433233      24        99000 -2.449294e-16  1.000000    0.159063   -0.987268   \n",
       "19433337      24       661000 -2.449294e-16  1.000000    0.159063   -0.987268   \n",
       "19433393      25       119000 -2.449294e-16  1.000000    0.159063   -0.987268   \n",
       "\n",
       "          second_sin  second_cos  microsecond_sin  microsecond_cos  has_cert  \\\n",
       "index                                                                          \n",
       "481         0.413212    0.910635        -0.493176         0.869930     False   \n",
       "641         0.596367    0.802712        -0.647593         0.761987     False   \n",
       "1012        0.957422    0.288692        -0.892926        -0.450204      True   \n",
       "1540        0.716457   -0.697632        -0.968128        -0.250456     False   \n",
       "1561        0.638244   -0.769834         0.771074         0.636745     False   \n",
       "...              ...         ...              ...              ...       ...   \n",
       "19432876    0.716457   -0.697632         0.994456         0.105154     False   \n",
       "19433035    0.716457   -0.697632        -0.948498        -0.316783     False   \n",
       "19433233    0.552800   -0.833314         0.583196         0.812331     False   \n",
       "19433337    0.552800   -0.833314        -0.849876        -0.526983     False   \n",
       "19433393    0.461093   -0.887352         0.680502         0.732746     False   \n",
       "\n",
       "          has_dns_host group_id  \n",
       "index                            \n",
       "481               True        x  \n",
       "641               True        x  \n",
       "1012              True        x  \n",
       "1540              True        x  \n",
       "1561              True        x  \n",
       "...                ...      ...  \n",
       "19432876          True        x  \n",
       "19433035          True        x  \n",
       "19433233          True        x  \n",
       "19433337          True        x  \n",
       "19433393          True        x  \n",
       "\n",
       "[100000 rows x 45 columns]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "Index: 100000 entries, 481 to 19433393\n",
      "Data columns (total 45 columns):\n",
      " #   Column                            Non-Null Count   Dtype         \n",
      "---  ------                            --------------   -----         \n",
      " 0   firstPacket                       100000 non-null  datetime64[ns]\n",
      " 1   lastPacket                        100000 non-null  datetime64[ns]\n",
      " 2   ipProtocol                        100000 non-null  int64         \n",
      " 3   protocol                          100000 non-null  string        \n",
      " 4   rootId                            583 non-null     string        \n",
      " 5   totDataBytes                      100000 non-null  int64         \n",
      " 6   client.bytes                      100000 non-null  int64         \n",
      " 7   server.bytes                      100000 non-null  int64         \n",
      " 8   source.ip                         100000 non-null  object        \n",
      " 9   source.port                       100000 non-null  int64         \n",
      " 10  destination.ip                    100000 non-null  object        \n",
      " 11  destination.port                  100000 non-null  int64         \n",
      " 12  network.packets                   100000 non-null  int64         \n",
      " 13  source.packets                    100000 non-null  int64         \n",
      " 14  destination.packets               100000 non-null  int64         \n",
      " 15  network.bytes                     100000 non-null  int64         \n",
      " 16  source.bytes                      100000 non-null  int64         \n",
      " 17  destination.bytes                 100000 non-null  int64         \n",
      " 18  node                              100000 non-null  object        \n",
      " 19  http.uri                          6695 non-null    object        \n",
      " 20  source.geo.country_iso_code       515 non-null     object        \n",
      " 21  destination.geo.country_iso_code  5839 non-null    object        \n",
      " 22  dns.host                          100000 non-null  object        \n",
      " 23  cert                              1671 non-null    object        \n",
      " 24  irc.channel                       0 non-null       float64       \n",
      " 25  http.xffGEO                       67 non-null      object        \n",
      " 26  time_idx                          100000 non-null  int64         \n",
      " 27  time_from_start_to_last_packet    100000 non-null  float64       \n",
      " 28  time_from_start_to_first_packet   100000 non-null  float64       \n",
      " 29  time_idx_nogap                    100000 non-null  int64         \n",
      " 30  hour                              100000 non-null  int32         \n",
      " 31  minute                            100000 non-null  int32         \n",
      " 32  second                            100000 non-null  int32         \n",
      " 33  microsecond                       100000 non-null  int32         \n",
      " 34  hour_sin                          100000 non-null  float64       \n",
      " 35  hour_cos                          100000 non-null  float64       \n",
      " 36  minute_sin                        100000 non-null  float64       \n",
      " 37  minute_cos                        100000 non-null  float64       \n",
      " 38  second_sin                        100000 non-null  float64       \n",
      " 39  second_cos                        100000 non-null  float64       \n",
      " 40  microsecond_sin                   100000 non-null  float64       \n",
      " 41  microsecond_cos                   100000 non-null  float64       \n",
      " 42  has_cert                          100000 non-null  bool          \n",
      " 43  has_dns_host                      100000 non-null  bool          \n",
      " 44  group_id                          100000 non-null  object        \n",
      "dtypes: bool(2), datetime64[ns](2), float64(11), int32(4), int64(14), object(10), string(2)\n",
      "memory usage: 32.2+ MB\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "None"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "Index: 100000 entries, 115 to 19433393\n",
      "Data columns (total 19 columns):\n",
      " #   Column            Non-Null Count  Dtype \n",
      "---  ------            --------------  ----- \n",
      " 0   is_multicast      99933 non-null  object\n",
      " 1   is_private        99933 non-null  object\n",
      " 2   is_global         99933 non-null  object\n",
      " 3   is_unspecified    99933 non-null  object\n",
      " 4   is_reserved       99933 non-null  object\n",
      " 5   is_loopback       99933 non-null  object\n",
      " 6   is_link_local     99933 non-null  object\n",
      " 7   blue_team         12536 non-null  object\n",
      " 8   facility          68074 non-null  object\n",
      " 9   service           99933 non-null  object\n",
      " 10  critservice       99933 non-null  object\n",
      " 11  hostname          30452 non-null  object\n",
      " 12  dns_alias         23540 non-null  object\n",
      " 13  hardware          30452 non-null  object\n",
      " 14  opsys             30876 non-null  object\n",
      " 15  sharedinfra       637 non-null    object\n",
      " 16  is_red_team       99933 non-null  object\n",
      " 17  dns_lookup_host   368 non-null    object\n",
      " 18  dns_lookup_alias  99933 non-null  object\n",
      "dtypes: object(19)\n",
      "memory usage: 15.3+ MB\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "None"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "\n",
    "timestamp_columns = ['firstPacket', 'lastPacket']\n",
    "for col in timestamp_columns:\n",
    "    data[f'{col}'] = pd.to_datetime(data[col], unit='ms')\n",
    "\n",
    "start_time = data['firstPacket'].min()\n",
    "end_time = data['lastPacket'].max()\n",
    "data['time_idx'] = ((data['lastPacket'] - start_time).dt.ceil('ms').dt.total_seconds()*1000).astype(np.int64)\n",
    "data['time_from_start_to_last_packet'] = (data['lastPacket'] - start_time).dt.total_seconds()\n",
    "data['time_from_start_to_first_packet'] = (data['firstPacket'] - start_time).dt.total_seconds()\n",
    "\n",
    "data = data.sort_values(by='time_idx')\n",
    "data['time_idx_nogap'] = list(range(data.shape[0]))\n",
    "\n",
    "\n",
    "data['hour'] = data['lastPacket'].dt.hour\n",
    "# data['day'] = data['lastPacket'].day\n",
    "# data['day_of_week'] = data['lastPacket'].dayofweek\n",
    "data['minute'] = data['lastPacket'].dt.minute\n",
    "data['second'] = data['lastPacket'].dt.second\n",
    "data['microsecond'] = data['lastPacket'].dt.microsecond\n",
    "\n",
    "CYCLIC_COLS = [\n",
    "    'hour',\n",
    "    'minute',\n",
    "    'second',\n",
    "    'microsecond'\n",
    "]\n",
    "\n",
    "for col in CYCLIC_COLS:\n",
    "    data[f\"{col}_sin\"]  = np.sin((2*np.pi*data[col])/max(data[col]))\n",
    "    data[f\"{col}_cos\"]  = np.cos((2*np.pi*data[col])/max(data[col]))\n",
    "\n",
    "\n",
    "data['has_cert'] = data['cert'].notna()\n",
    "data['has_dns_host'] = data['dns.host'].notna()\n",
    "data['group_id'] = 'x'\n",
    "\n",
    "\n",
    "# data['destination.port.s'] = data['destination.port'].astype(str)\n",
    "\n",
    "# data.rename(\n",
    "#     columns={\n",
    "#         name: name.replace('.', '_') for name in list(data.columns)\n",
    "#     },\n",
    "#     inplace=True\n",
    "# )\n",
    "# data.replace('', np.nan)\n",
    "\n",
    "# testing_cutoff = pd.to_datetime('2016-04-22 21:00:00')\n",
    "# testing_df = data[data['lastPacket'] > testing_cutoff]\n",
    "\n",
    "\n",
    "# validation_cutoff = pd.to_datetime('2016-04-22 20:30:00')\n",
    "# validation_df = data[(data['lastPacket'] > validation_cutoff) & (data['lastPacket'] < testing_cutoff)]\n",
    "\n",
    "# training_df = data[data['lastPacket'] <= validation_cutoff]\n",
    "if IS_LOCAL:\n",
    "    view_df(data)\n",
    "display(data.info())\n",
    "_ = display(label.info())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "CATEGORICAL_COLS = [\n",
    "    # 'rootId',\n",
    "    'ipProtocol',\n",
    "    'protocol',\n",
    "    'source.ip',\n",
    "    'source.port',\n",
    "    'destination.ip',\n",
    "    'destination.port',\n",
    "    # 'node',\n",
    "    # 'http.uri',\n",
    "    'source.geo.country_iso_code',\n",
    "    'destination.geo.country_iso_code',\n",
    "    # 'dns.host',\n",
    "    'has_dns_host',\n",
    "    # 'cert',\n",
    "    # 'irc.channel',\n",
    "    # 'http.xffGEO',\n",
    "    'has_cert',\n",
    "]\n",
    "\n",
    "COUNTRY_ISO_CODE_COLS = ['source.geo.country_iso_code', 'destination.geo.country_iso_code']\n",
    "\n",
    "# array_str_cols = ['protocol', 'dns.host', 'service', 'critservice', 'dns_lookup_alias']\n",
    "\n",
    "NUMERIC_COLS = [\n",
    "    'totDataBytes',\n",
    "    'client.bytes',\n",
    "    'server.bytes',\n",
    "    'network.packets',\n",
    "    'source.packets',\n",
    "    'destination.packets',\n",
    "    'network.bytes',\n",
    "    'source.bytes',\n",
    "    'destination.bytes',\n",
    "]\n",
    "\n",
    "LABEL_BINARY_COLS = [\n",
    "    # 'is_multicast',\n",
    "    'is_private','is_global',\n",
    "    'is_unspecified',\n",
    "    # 'is_reserved',\n",
    "    # 'is_loopback', # only 6 positive\n",
    "    'is_link_local',\n",
    "    'is_red_team',\n",
    "\n",
    "]\n",
    "LABEL_MULTI_CLASSES_COLS =[\n",
    "    'blue_team','facility','service',\n",
    "    # 'critservice',\n",
    "    'hostname',\n",
    "    'dns_alias',\n",
    "    'hardware',\n",
    "    'opsys',\n",
    "    # 'sharedinfra',\n",
    "    # 'dns_lookup_host',\n",
    "    # 'dns_lookup_alias'\n",
    "]\n",
    "\n",
    "new_cyclic_cols = [\n",
    "    c for col in CYCLIC_COLS for c in [f'{col}_sin', f'{col}_cos']\n",
    "]\n",
    "\n",
    "NUMERIC_COLS += new_cyclic_cols\n",
    "\n",
    "for col in CATEGORICAL_COLS:\n",
    "    data[col] = data[col].astype('category')\n",
    "\n",
    "for col in LABEL_BINARY_COLS + LABEL_MULTI_CLASSES_COLS:\n",
    "    label[col] = label[col].astype('category')\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Train/Val/Test Splits"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "from typing import Union, List, Callable\n",
    "from sklearn.model_selection import train_test_split\n",
    "\n",
    "RANDOM_STATE = 42\n",
    "\n",
    "def split_by_time(\n",
    "        data: pd.DataFrame, label: pd.DataFrame = None,\n",
    "        validation_cutoff = pd.to_datetime('2016-04-22 20:30:00'),\n",
    "        testing_cutoff = pd.to_datetime('2016-04-22 21:00:00')\n",
    "    ):\n",
    "    mask_train = data['lastPacket'] > testing_cutoff\n",
    "    X_test = data[mask_train]\n",
    "    if label:\n",
    "        y_test = label[mask_train]\n",
    "    \n",
    "    mask_val = (data['lastPacket'] > validation_cutoff) & (data['lastPacket'] < testing_cutoff)\n",
    "    X_val = data[mask_val]\n",
    "    if label:\n",
    "        y_val = label[mask_val]\n",
    "\n",
    "    mask_train = data['lastPacket'] <= validation_cutoff\n",
    "    X_train = data[mask_train]\n",
    "    if label:\n",
    "        y_train = label[mask_train]\n",
    "\n",
    "    if label:\n",
    "        return (X_train, y_train), (X_val, y_val), (X_test, y_test)\n",
    "    else:\n",
    "        return (X_train, X_val, X_test)\n",
    "\n",
    "def split_by_row(data: pd.DataFrame, label: Union[pd.DataFrame, pd.Series]=None, test_size=0.2, val_size=0.1):\n",
    "    X_train_val, X_test, y_train_val, y_test = train_test_split(data, label, test_size=test_size, random_state=RANDOM_STATE)\n",
    "    X_train, X_val, y_train, y_val = train_test_split(X_train_val, y_train_val, test_size=val_size)\n",
    "    return (X_train, y_train), (X_val, y_val), (X_test, y_test)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Initialize TimeSeriesDataset and Models"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Indexing - step 2/2: 100%|██████████| 1/1 [00:50<00:00, 50.92s/it]\n",
      "Indexing - step 1/2: 100%|██████████| 1/1 [00:00<00:00,  9.57it/s]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Finished Indexing in 51.06(s)\n",
      "Missing time steps:  0.00%(0/71183)\n",
      "Preprocessing ...\n",
      "Done\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Indexing - step 2/2: 100%|██████████| 1/1 [00:03<00:00,  3.09s/it]\n",
      "Indexing - step 1/2: 100%|██████████| 1/1 [00:00<00:00, 499.62it/s]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Finished Indexing in 3.10(s)\n",
      "Missing time steps:  0.00%(0/5315)\n",
      "Preprocessing ...\n",
      "Done\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Indexing - step 2/2: 100%|██████████| 1/1 [00:12<00:00, 12.03s/it]\n",
      "Indexing - step 1/2: 100%|██████████| 1/1 [00:00<00:00, 260.40it/s]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Finished Indexing in 12.05(s)\n",
      "Missing time steps:  0.00%(0/23502)\n",
      "Preprocessing ...\n",
      "Done\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "ic| len(train_dataset): 71173\n",
      "    len(val_dataset): 531\n",
      "    len(test_dataset): 2350\n",
      "ic| len(train_loader): 278, len(val_loader): 3, len(test_loader): 10\n",
      "ic| model: <LSTMAnnotation>(Params: {'group_ids': ['group_id'], 'time_idx': 'time_idx_nogap', 'min_encoder_length': 0, 'max_encoder_length': 0, 'min_decoder_length': 1, 'max_decoder_length': 10, 'encoder_variables': [], 'decoder_variables': ['totDataBytes', 'client_bytes', 'server_bytes', 'network_packets', 'source_packets', 'destination_packets', 'network_bytes', 'source_bytes', 'destination_bytes', 'hour_sin', 'hour_cos', 'minute_sin', 'minute_cos', 'second_sin', 'second_cos', 'microsecond_sin', 'microsecond_cos', 'ipProtocol', 'protocol', 'source_geo_country_iso_code', 'destination_geo_country_iso_code', 'has_dns_host', 'has_cert'], 'targets': ['is_private', 'is_global', 'is_unspecified', 'is_link_local', 'is_red_team', 'blue_team', 'facility', 'service', 'hostname', 'dns_alias', 'hardware', 'opsys'], 'static_variables': [], 'training': True, 'random_length': True, 'scalers': {'ipProtocol': NaNLabelEncoder, 'source_geo_country_iso_code': NaNLabelEncoder, 'protocol': NaNLabelEncoder, 'has_dns_host': NaNLabelEncoder, 'destination_geo_country_iso_code': NaNLabelEncoder, 'has_cert': NaNLabelEncoder, 'second_cos': StandardScaler(), 'client_bytes': StandardScaler(), 'minute_cos': StandardScaler(), 'microsecond_sin': StandardScaler(), 'totDataBytes': StandardScaler(), 'network_packets': StandardScaler(), 'hour_cos': StandardScaler(), 'network_bytes': StandardScaler(), 'second_sin': StandardScaler(), 'source_bytes': StandardScaler(), 'minute_sin': StandardScaler(), 'destination_bytes': StandardScaler(), 'source_packets': StandardScaler(), 'microsecond_cos': StandardScaler(), 'server_bytes': StandardScaler(), 'destination_packets': StandardScaler(), 'hour_sin': StandardScaler()}, 'target_normalizers': {'is_private': LabelEncoder(), 'is_global': LabelEncoder(), 'is_unspecified': LabelEncoder(), 'is_link_local': LabelEncoder(), 'is_red_team': LabelEncoder(), 'blue_team': LabelEncoder(), 'facility': LabelEncoder(), 'service': LabelEncoder(), 'hostname': LabelEncoder(), 'dns_alias': LabelEncoder(), 'hardware': LabelEncoder(), 'opsys': LabelEncoder()}, 'imputers': None, 'add_na': False, 'ignore_na': False, 'allow_missing_time_steps': True, 'unknown_value': nan, 'non_overlapped_windows': False, 'return_missing_mask': False}, Properties: DatasetProperties(encoder_names=[], decoder_names=['totDataBytes', 'client_bytes', 'server_bytes', 'network_packets', 'source_packets', 'destination_packets', 'network_bytes', 'source_bytes', 'destination_bytes', 'hour_sin', 'hour_cos', 'minute_sin', 'minute_cos', 'second_sin', 'second_cos', 'microsecond_sin', 'microsecond_cos', 'ipProtocol', 'protocol', 'source_geo_country_iso_code', 'destination_geo_country_iso_code', 'has_dns_host', 'has_cert'], cat_names=['ipProtocol', 'source_geo_country_iso_code', 'protocol', 'has_dns_host', 'destination_geo_country_iso_code', 'has_cert'], cat_sizes={'ipProtocol': 4, 'source_geo_country_iso_code': 11, 'protocol': 39, 'has_dns_host': 1, 'destination_geo_country_iso_code': 28, 'has_cert': 2}, cont_names=['second_cos', 'client_bytes', 'minute_cos', 'microsecond_sin', 'totDataBytes', 'network_packets', 'hour_cos', 'network_bytes', 'second_sin', 'source_bytes', 'minute_sin', 'destination_bytes', 'source_packets', 'microsecond_cos', 'server_bytes', 'destination_packets', 'hour_sin'], decoder_cat_names=['ipProtocol', 'protocol', 'source_geo_country_iso_code', 'destination_geo_country_iso_code', 'has_dns_host', 'has_cert'], decoder_cat_positions=[17, 18, 19, 20, 21, 22], decoder_cont_names=['totDataBytes', 'client_bytes', 'server_bytes', 'network_packets', 'source_packets', 'destination_packets', 'network_bytes', 'source_bytes', 'destination_bytes', 'hour_sin', 'hour_cos', 'minute_sin', 'minute_cos', 'second_sin', 'second_cos', 'microsecond_sin', 'microsecond_cos'], decoder_cont_positions=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16], encoder_cat_names=[], encoder_cat_positions=[], encoder_cont_names=[], encoder_cont_positions=[], features=['ipProtocol', 'source_geo_country_iso_code', 'protocol', 'has_dns_host', 'destination_geo_country_iso_code', 'has_cert', 'second_cos', 'client_bytes', 'minute_cos', 'microsecond_sin', 'totDataBytes', 'network_packets', 'hour_cos', 'network_bytes', 'second_sin', 'source_bytes', 'minute_sin', 'destination_bytes', 'source_packets', 'microsecond_cos', 'server_bytes', 'destination_packets', 'hour_sin'], max_length=10, min_length=1, target_cat_names=['is_private', 'is_global', 'is_unspecified', 'is_link_local', 'is_red_team', 'blue_team', 'facility', 'service', 'hostname', 'dns_alias', 'hardware', 'opsys'], target_cat_positions=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], target_cat_sizes={'is_private': 2, 'is_global': 2, 'is_unspecified': 2, 'is_link_local': 2, 'is_red_team': 2, 'blue_team': 10, 'facility': 3, 'service': 14, 'hostname': 15, 'dns_alias': 3, 'hardware': 6, 'opsys': 15}, target_cont_names=[], target_cont_positions=[], target_positions={'is_private': 0, 'is_global': 1, 'is_unspecified': 2, 'is_link_local': 3, 'is_red_team': 4, 'blue_team': 5, 'facility': 6, 'service': 7, 'hostname': 8, 'dns_alias': 9, 'hardware': 10, 'opsys': 11}))\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "<LSTMAnnotation>(Params: {'group_ids': ['group_id'], 'time_idx': 'time_idx_nogap', 'min_encoder_length': 0, 'max_encoder_length': 0, 'min_decoder_length': 1, 'max_decoder_length': 10, 'encoder_variables': [], 'decoder_variables': ['totDataBytes', 'client_bytes', 'server_bytes', 'network_packets', 'source_packets', 'destination_packets', 'network_bytes', 'source_bytes', 'destination_bytes', 'hour_sin', 'hour_cos', 'minute_sin', 'minute_cos', 'second_sin', 'second_cos', 'microsecond_sin', 'microsecond_cos', 'ipProtocol', 'protocol', 'source_geo_country_iso_code', 'destination_geo_country_iso_code', 'has_dns_host', 'has_cert'], 'targets': ['is_private', 'is_global', 'is_unspecified', 'is_link_local', 'is_red_team', 'blue_team', 'facility', 'service', 'hostname', 'dns_alias', 'hardware', 'opsys'], 'static_variables': [], 'training': True, 'random_length': True, 'scalers': {'ipProtocol': NaNLabelEncoder, 'source_geo_country_iso_code': NaNLabelEncoder, 'protocol': NaNLabelEncoder, 'has_dns_host': NaNLabelEncoder, 'destination_geo_country_iso_code': NaNLabelEncoder, 'has_cert': NaNLabelEncoder, 'second_cos': StandardScaler(), 'client_bytes': StandardScaler(), 'minute_cos': StandardScaler(), 'microsecond_sin': StandardScaler(), 'totDataBytes': StandardScaler(), 'network_packets': StandardScaler(), 'hour_cos': StandardScaler(), 'network_bytes': StandardScaler(), 'second_sin': StandardScaler(), 'source_bytes': StandardScaler(), 'minute_sin': StandardScaler(), 'destination_bytes': StandardScaler(), 'source_packets': StandardScaler(), 'microsecond_cos': StandardScaler(), 'server_bytes': StandardScaler(), 'destination_packets': StandardScaler(), 'hour_sin': StandardScaler()}, 'target_normalizers': {'is_private': LabelEncoder(), 'is_global': LabelEncoder(), 'is_unspecified': LabelEncoder(), 'is_link_local': LabelEncoder(), 'is_red_team': LabelEncoder(), 'blue_team': LabelEncoder(), 'facility': LabelEncoder(), 'service': LabelEncoder(), 'hostname': LabelEncoder(), 'dns_alias': LabelEncoder(), 'hardware': LabelEncoder(), 'opsys': LabelEncoder()}, 'imputers': None, 'add_na': False, 'ignore_na': False, 'allow_missing_time_steps': True, 'unknown_value': nan, 'non_overlapped_windows': False, 'return_missing_mask': False}, Properties: DatasetProperties(encoder_names=[], decoder_names=['totDataBytes', 'client_bytes', 'server_bytes', 'network_packets', 'source_packets', 'destination_packets', 'network_bytes', 'source_bytes', 'destination_bytes', 'hour_sin', 'hour_cos', 'minute_sin', 'minute_cos', 'second_sin', 'second_cos', 'microsecond_sin', 'microsecond_cos', 'ipProtocol', 'protocol', 'source_geo_country_iso_code', 'destination_geo_country_iso_code', 'has_dns_host', 'has_cert'], cat_names=['ipProtocol', 'source_geo_country_iso_code', 'protocol', 'has_dns_host', 'destination_geo_country_iso_code', 'has_cert'], cat_sizes={'ipProtocol': 4, 'source_geo_country_iso_code': 11, 'protocol': 39, 'has_dns_host': 1, 'destination_geo_country_iso_code': 28, 'has_cert': 2}, cont_names=['second_cos', 'client_bytes', 'minute_cos', 'microsecond_sin', 'totDataBytes', 'network_packets', 'hour_cos', 'network_bytes', 'second_sin', 'source_bytes', 'minute_sin', 'destination_bytes', 'source_packets', 'microsecond_cos', 'server_bytes', 'destination_packets', 'hour_sin'], decoder_cat_names=['ipProtocol', 'protocol', 'source_geo_country_iso_code', 'destination_geo_country_iso_code', 'has_dns_host', 'has_cert'], decoder_cat_positions=[17, 18, 19, 20, 21, 22], decoder_cont_names=['totDataBytes', 'client_bytes', 'server_bytes', 'network_packets', 'source_packets', 'destination_packets', 'network_bytes', 'source_bytes', 'destination_bytes', 'hour_sin', 'hour_cos', 'minute_sin', 'minute_cos', 'second_sin', 'second_cos', 'microsecond_sin', 'microsecond_cos'], decoder_cont_positions=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16], encoder_cat_names=[], encoder_cat_positions=[], encoder_cont_names=[], encoder_cont_positions=[], features=['ipProtocol', 'source_geo_country_iso_code', 'protocol', 'has_dns_host', 'destination_geo_country_iso_code', 'has_cert', 'second_cos', 'client_bytes', 'minute_cos', 'microsecond_sin', 'totDataBytes', 'network_packets', 'hour_cos', 'network_bytes', 'second_sin', 'source_bytes', 'minute_sin', 'destination_bytes', 'source_packets', 'microsecond_cos', 'server_bytes', 'destination_packets', 'hour_sin'], max_length=10, min_length=1, target_cat_names=['is_private', 'is_global', 'is_unspecified', 'is_link_local', 'is_red_team', 'blue_team', 'facility', 'service', 'hostname', 'dns_alias', 'hardware', 'opsys'], target_cat_positions=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], target_cat_sizes={'is_private': 2, 'is_global': 2, 'is_unspecified': 2, 'is_link_local': 2, 'is_red_team': 2, 'blue_team': 10, 'facility': 3, 'service': 14, 'hostname': 15, 'dns_alias': 3, 'hardware': 6, 'opsys': 15}, target_cont_names=[], target_cont_positions=[], target_positions={'is_private': 0, 'is_global': 1, 'is_unspecified': 2, 'is_link_local': 3, 'is_red_team': 4, 'blue_team': 5, 'facility': 6, 'service': 7, 'hostname': 8, 'dns_alias': 9, 'hardware': 10, 'opsys': 11}))"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "from typing import Iterator, Optional, Sized\n",
    "from united.data.samplers import BySimilarLengthBatchSampler\n",
    "from united.data.timeseries import TimeSeriesDataset\n",
    "group_ids = [\n",
    "            # 'destination.ip', \n",
    "            # 'destination.port'\n",
    "            'group_id'\n",
    "        ]\n",
    "features= NUMERIC_COLS + CATEGORICAL_COLS\n",
    "targets = LABEL_BINARY_COLS + LABEL_MULTI_CLASSES_COLS\n",
    "# targets = ['service']\n",
    "\n",
    "\n",
    "X = pd.concat([data, label], axis=1)\n",
    "# for t in targets:\n",
    "#     X = X[X[t].notna()]\n",
    "X_train, X_val, X_test = split_by_time(X)\n",
    "\n",
    "\n",
    "drop_destination_ip = True\n",
    "drop_source_ip = True\n",
    "to_remove_features = []\n",
    "if drop_source_ip:\n",
    "    to_remove_features += ['source.ip', 'source.port']\n",
    "if drop_destination_ip:\n",
    "    to_remove_features += ['destination.ip', 'destination.port']\n",
    "\n",
    "for f in to_remove_features:\n",
    "    try:\n",
    "        features.remove(f)\n",
    "    except:\n",
    "        pass\n",
    "\n",
    "\n",
    "train_dataset = TimeSeriesDataset(\n",
    "    X_train,\n",
    "    group_ids=group_ids,\n",
    "    # time_idx='lastPacket',\n",
    "    # time_idx='time_idx',\n",
    "    time_idx='time_idx_nogap',\n",
    "    min_encoder_length= 0,\n",
    "    max_encoder_length= 0,\n",
    "    min_decoder_length=1,\n",
    "    max_decoder_length=10,\n",
    "    encoder_variables=[], \n",
    "    decoder_variables=features,\n",
    "    targets=targets,\n",
    "    training = True,\n",
    "    add_na=False,\n",
    "    ignore_na=False,\n",
    "    allow_missing_time_steps=True,\n",
    "    # imputers='ffill', # 'bfill', 'linear', 'mean, OR \n",
    "    # imputers={\n",
    "    #     'client.bytes': 'mean',\n",
    "    #     'network.packets': sklearn.impute.SimpleImputer()\n",
    "    # }\n",
    ")\n",
    "val_dataset = TimeSeriesDataset.from_dataset(\n",
    "    train_dataset,\n",
    "    X_val,\n",
    "    training=False,\n",
    "    ignore_na=True,\n",
    "    non_overlapped_windows=True,\n",
    ")\n",
    "test_dataset = TimeSeriesDataset.from_dataset(\n",
    "    train_dataset,\n",
    "    X_test,\n",
    "    training=False,\n",
    "    ignore_na=True,\n",
    "    non_overlapped_windows=True\n",
    ")\n",
    "batch_size = 256\n",
    "num_workers = 4\n",
    "\n",
    "# sampler = BySimilarLengthBatchSampler(train_dataset, batch_size=batch_size, drop_last=True)\n",
    "# train_loader = DataLoader(\n",
    "#     train_dataset,\n",
    "#     collate_fn=train_dataset._collate_fn,\n",
    "#     # batch_sampler=sampler,\n",
    "#     batch_size=batch_size,\n",
    "#     drop_last=True\n",
    "# )\n",
    "train_loader = train_dataset.to_dataloader(batch_size=batch_size, num_workers=num_workers)\n",
    "val_loader = val_dataset.to_dataloader(batch_size, num_workers=0)\n",
    "test_loader = test_dataset.to_dataloader(batch_size, num_workers=0)\n",
    "it = iter(train_loader)\n",
    "from united.models.annotation import TransformerAnnotation, LSTMAnnotation\n",
    "if model_name == \"transformer\":\n",
    "    model = TransformerAnnotation.from_dataset(\n",
    "        train_dataset,\n",
    "        dropout=0.2,\n",
    "        # losses={\n",
    "        #     'service': 'cross_entropy_with_logits' # auto, mse, #smape\n",
    "        #     # 'another_target': torch.functional.cross_entropy_loss\n",
    "        # },\n",
    "        losses='auto', # None, 'mse', ...\n",
    "    )\n",
    "elif model_name == \"lstm\":\n",
    "    model = LSTMAnnotation.from_dataset(train_dataset)\n",
    "else:\n",
    "    raise ValueError(f\"Unknown model_name: {model_name}\")\n",
    "\n",
    "ic(len(train_dataset), len(val_dataset), len(test_dataset))\n",
    "ic(len(train_loader), len(val_loader), len(test_loader))\n",
    "ic(model)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Training"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "GPU available: False, used: False\n",
      "TPU available: False, using: 0 TPU cores\n",
      "IPU available: False, using: 0 IPUs\n",
      "HPU available: False, using: 0 HPUs\n",
      "\n",
      "  | Name       | Type       | Params\n",
      "------------------------------------------\n",
      "0 | embeddings | ModuleDict | 829   \n",
      "1 | lstm       | LSTM       | 315 K \n",
      "2 | predictors | ModuleDict | 19.5 K\n",
      "------------------------------------------\n",
      "335 K     Trainable params\n",
      "0         Non-trainable params\n",
      "335 K     Total params\n",
      "1.343     Total estimated model params size (MB)\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "440eeeb333114250b970952a381cb7d1",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Sanity Checking: 0it [00:00, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/lightning/pytorch/trainer/connectors/data_connector.py:430: PossibleUserWarning: The dataloader, val_dataloader, does not have many workers which may be a bottleneck. Consider increasing the value of the `num_workers` argument` (try 8 which is the number of cpus on this machine) in the `DataLoader` init to improve performance.\n",
      "  rank_zero_warn(\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "38a1da3cb73f4510bf32fd40cda03eb6",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Training: 0it [00:00, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "ee0b2365465d4245914fadecdb32d816",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Validation: 0it [00:00, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/lightning/pytorch/trainer/connectors/logger_connector/result.py:212: UserWarning: You called `self.log('is_unspecified/val/auc', ...)` in your `on_validation_epoch_end` but the value needs to be floating point. Converting it to torch.float32.\n",
      "  warning_cache.warn(\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/lightning/pytorch/trainer/connectors/logger_connector/result.py:212: UserWarning: You called `self.log('is_link_local/val/auc', ...)` in your `on_validation_epoch_end` but the value needs to be floating point. Converting it to torch.float32.\n",
      "  warning_cache.warn(\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "14dd342bbfe6452f8b26bc1e2cc4f026",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Validation: 0it [00:00, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "5bd721fa614348068496d70aafe92cb8",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Validation: 0it [00:00, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "150dec36b20349c8870782df770d994b",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Validation: 0it [00:00, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "87d6f23077454ea3b59f75c9d9c9fb8b",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Validation: 0it [00:00, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "de33610254884b0a9f190301ed7a559d",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Validation: 0it [00:00, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/OneDrive_Deakin/DAIRNet-Proj/code/pytorch-forecasting-extras/united/utils.py:65: UserWarning: y_true has only one unique value: [0.]\n",
      "  warnings.warn(f\"y_true has only one unique value: {np.unique(y_true)}\")\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py:54: UserWarning: Detected KeyboardInterrupt, attempting graceful shutdown...\n",
      "  rank_zero_warn(\"Detected KeyboardInterrupt, attempting graceful shutdown...\")\n",
      "Restoring states from the checkpoint path at runs/tagging/lstm/dev/lightning_logs/version_21/checkpoints/epoch=2-step=834.ckpt\n",
      "Loaded model weights from the checkpoint at runs/tagging/lstm/dev/lightning_logs/version_21/checkpoints/epoch=2-step=834.ckpt\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/lightning/pytorch/trainer/connectors/data_connector.py:430: PossibleUserWarning: The dataloader, test_dataloader, does not have many workers which may be a bottleneck. Consider increasing the value of the `num_workers` argument` (try 8 which is the number of cpus on this machine) in the `DataLoader` init to improve performance.\n",
      "  rank_zero_warn(\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "b3a9c060d13649bb80b8145673f741ac",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Testing: 0it [00:00, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n",
      "/home/ntquy/anaconda3/envs/ts/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples. Use `zero_division` parameter to control this behavior.\n",
      "  _warn_prf(average, modifier, msg_start, len(result))\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
       "┃<span style=\"font-weight: bold\">           Test metric            </span>┃<span style=\"font-weight: bold\">           DataLoader 0           </span>┃\n",
       "┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">        ALL/test/accuracy         </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.6489091591707347        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">           ALL/test/auc           </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.7411571210046265        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">      ALL/test/bal_accuracy       </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.3677923030589538        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">     blue_team/test/accuracy      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.17783066984019041        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">        blue_team/test/auc        </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.6553402750208722        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">   blue_team/test/bal_accuracy    </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.20109952594261332        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">       blue_team/test/loss/       </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        2.169919967651367         </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">     dns_alias/test/accuracy      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.5256603773584906        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">        dns_alias/test/auc        </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.48116374589762206        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">   dns_alias/test/bal_accuracy    </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.3502140343053888        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">       dns_alias/test/loss/       </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        1.2009433507919312        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">      facility/test/accuracy      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.884077892325315         </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">        facility/test/auc         </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.6938321599566777        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">    facility/test/bal_accuracy    </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.3827884772440507        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">       facility/test/loss/        </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.4058431088924408        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">      hardware/test/accuracy      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.3151812569257559        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">        hardware/test/auc         </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.6963469542604255        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">    hardware/test/bal_accuracy    </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.27417038278277867        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">       hardware/test/loss/        </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        1.6438039541244507        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">      hostname/test/accuracy      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.21545037201203102        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">        hostname/test/auc         </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.6404705581535092        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">    hostname/test/bal_accuracy    </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.16973930145704288        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">       hostname/test/loss/        </span>│<span style=\"color: #800080; text-decoration-color: #800080\">         2.4310302734375          </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">            hp_metric             </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        1.0249712467193604        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">     is_global/test/accuracy      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.9949331516648215        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">        is_global/test/auc        </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.9907594556371815        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">   is_global/test/bal_accuracy    </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.5809859154929577        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">       is_global/test/loss/       </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.012222806923091412       </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">   is_link_local/test/accuracy    </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.9998296857702461        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">      is_link_local/test/auc      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.8998275274678478        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\"> is_link_local/test/bal_accuracy  </span>│<span style=\"color: #800080; text-decoration-color: #800080\">               0.5                </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">     is_link_local/test/loss/     </span>│<span style=\"color: #800080; text-decoration-color: #800080\">      0.0026824683882296085       </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">     is_private/test/accuracy     </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.9946776803201908        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">       is_private/test/auc        </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.990547681220979         </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">   is_private/test/bal_accuracy   </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.5598591549295775        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">      is_private/test/loss/       </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.012920025736093521       </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">    is_red_team/test/accuracy     </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.7074853103976837        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">       is_red_team/test/auc       </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.7095396064497175        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">  is_red_team/test/bal_accuracy   </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.6440169249202753        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">      is_red_team/test/loss/      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.5979527235031128        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">   is_unspecified/test/accuracy   </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.999914842885123         </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">     is_unspecified/test/auc      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.8803440640436042        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\"> is_unspecified/test/bal_accuracy </span>│<span style=\"color: #800080; text-decoration-color: #800080\">               0.5                </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">    is_unspecified/test/loss/     </span>│<span style=\"color: #800080; text-decoration-color: #800080\">      0.0018831967609003186       </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">       opsys/test/accuracy        </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.25280199252801994        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">          opsys/test/auc          </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.6363547918913738        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">     opsys/test/bal_accuracy      </span>│<span style=\"color: #800080; text-decoration-color: #800080\">         0.1633632049027          </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">         opsys/test/loss/         </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        2.342360734939575         </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">      service/test/accuracy       </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.7190666780209487        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">         service/test/auc         </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        0.6193586320557073        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">    service/test/bal_accuracy     </span>│<span style=\"color: #800080; text-decoration-color: #800080\">       0.08727071473006094        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">        service/test/loss/        </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        1.4780915975570679        </span>│\n",
       "│<span style=\"color: #008080; text-decoration-color: #008080\">            test/loss             </span>│<span style=\"color: #800080; text-decoration-color: #800080\">        1.0249712467193604        </span>│\n",
       "└──────────────────────────────────┴──────────────────────────────────┘\n",
       "</pre>\n"
      ],
      "text/plain": [
       "┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
       "┃\u001b[1m \u001b[0m\u001b[1m          Test metric           \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1m          DataLoader 0          \u001b[0m\u001b[1m \u001b[0m┃\n",
       "┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n",
       "│\u001b[36m \u001b[0m\u001b[36m       ALL/test/accuracy        \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.6489091591707347       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m          ALL/test/auc          \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.7411571210046265       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m     ALL/test/bal_accuracy      \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.3677923030589538       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m    blue_team/test/accuracy     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.17783066984019041       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m       blue_team/test/auc       \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.6553402750208722       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m  blue_team/test/bal_accuracy   \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.20109952594261332       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m      blue_team/test/loss/      \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       2.169919967651367        \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m    dns_alias/test/accuracy     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.5256603773584906       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m       dns_alias/test/auc       \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.48116374589762206       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m  dns_alias/test/bal_accuracy   \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.3502140343053888       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m      dns_alias/test/loss/      \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       1.2009433507919312       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m     facility/test/accuracy     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.884077892325315        \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m       facility/test/auc        \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.6938321599566777       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m   facility/test/bal_accuracy   \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.3827884772440507       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m      facility/test/loss/       \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.4058431088924408       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m     hardware/test/accuracy     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.3151812569257559       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m       hardware/test/auc        \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.6963469542604255       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m   hardware/test/bal_accuracy   \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.27417038278277867       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m      hardware/test/loss/       \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       1.6438039541244507       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m     hostname/test/accuracy     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.21545037201203102       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m       hostname/test/auc        \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.6404705581535092       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m   hostname/test/bal_accuracy   \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.16973930145704288       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m      hostname/test/loss/       \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m        2.4310302734375         \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m           hp_metric            \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       1.0249712467193604       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m    is_global/test/accuracy     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.9949331516648215       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m       is_global/test/auc       \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.9907594556371815       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m  is_global/test/bal_accuracy   \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.5809859154929577       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m      is_global/test/loss/      \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.012222806923091412      \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m  is_link_local/test/accuracy   \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.9998296857702461       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m     is_link_local/test/auc     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.8998275274678478       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36mis_link_local/test/bal_accuracy \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m              0.5               \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m    is_link_local/test/loss/    \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m     0.0026824683882296085      \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m    is_private/test/accuracy    \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.9946776803201908       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m      is_private/test/auc       \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.990547681220979        \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m  is_private/test/bal_accuracy  \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.5598591549295775       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m     is_private/test/loss/      \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.012920025736093521      \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m   is_red_team/test/accuracy    \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.7074853103976837       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m      is_red_team/test/auc      \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.7095396064497175       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m is_red_team/test/bal_accuracy  \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.6440169249202753       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m     is_red_team/test/loss/     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.5979527235031128       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m  is_unspecified/test/accuracy  \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.999914842885123        \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m    is_unspecified/test/auc     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.8803440640436042       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36mis_unspecified/test/bal_accuracy\u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m              0.5               \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m   is_unspecified/test/loss/    \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m     0.0018831967609003186      \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m      opsys/test/accuracy       \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.25280199252801994       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m         opsys/test/auc         \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.6363547918913738       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m    opsys/test/bal_accuracy     \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m        0.1633632049027         \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m        opsys/test/loss/        \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       2.342360734939575        \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m     service/test/accuracy      \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.7190666780209487       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m        service/test/auc        \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       0.6193586320557073       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m   service/test/bal_accuracy    \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m      0.08727071473006094       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m       service/test/loss/       \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       1.4780915975570679       \u001b[0m\u001b[35m \u001b[0m│\n",
       "│\u001b[36m \u001b[0m\u001b[36m           test/loss            \u001b[0m\u001b[36m \u001b[0m│\u001b[35m \u001b[0m\u001b[35m       1.0249712467193604       \u001b[0m\u001b[35m \u001b[0m│\n",
       "└──────────────────────────────────┴──────────────────────────────────┘\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/plain": [
       "[{'test/loss': 1.0249712467193604,\n",
       "  'is_private/test/loss/': 0.012920025736093521,\n",
       "  'is_global/test/loss/': 0.012222806923091412,\n",
       "  'is_unspecified/test/loss/': 0.0018831967609003186,\n",
       "  'is_link_local/test/loss/': 0.0026824683882296085,\n",
       "  'is_red_team/test/loss/': 0.5979527235031128,\n",
       "  'blue_team/test/loss/': 2.169919967651367,\n",
       "  'facility/test/loss/': 0.4058431088924408,\n",
       "  'service/test/loss/': 1.4780915975570679,\n",
       "  'hostname/test/loss/': 2.4310302734375,\n",
       "  'dns_alias/test/loss/': 1.2009433507919312,\n",
       "  'hardware/test/loss/': 1.6438039541244507,\n",
       "  'opsys/test/loss/': 2.342360734939575,\n",
       "  'hp_metric': 1.0249712467193604,\n",
       "  'is_private/test/auc': 0.990547681220979,\n",
       "  'is_private/test/accuracy': 0.9946776803201908,\n",
       "  'is_private/test/bal_accuracy': 0.5598591549295775,\n",
       "  'is_global/test/auc': 0.9907594556371815,\n",
       "  'is_global/test/accuracy': 0.9949331516648215,\n",
       "  'is_global/test/bal_accuracy': 0.5809859154929577,\n",
       "  'is_unspecified/test/auc': 0.8803440640436042,\n",
       "  'is_unspecified/test/accuracy': 0.999914842885123,\n",
       "  'is_unspecified/test/bal_accuracy': 0.5,\n",
       "  'is_link_local/test/auc': 0.8998275274678478,\n",
       "  'is_link_local/test/accuracy': 0.9998296857702461,\n",
       "  'is_link_local/test/bal_accuracy': 0.5,\n",
       "  'is_red_team/test/auc': 0.7095396064497175,\n",
       "  'is_red_team/test/accuracy': 0.7074853103976837,\n",
       "  'is_red_team/test/bal_accuracy': 0.6440169249202753,\n",
       "  'blue_team/test/auc': 0.6553402750208722,\n",
       "  'blue_team/test/accuracy': 0.17783066984019041,\n",
       "  'blue_team/test/bal_accuracy': 0.20109952594261332,\n",
       "  'facility/test/auc': 0.6938321599566777,\n",
       "  'facility/test/accuracy': 0.884077892325315,\n",
       "  'facility/test/bal_accuracy': 0.3827884772440507,\n",
       "  'service/test/auc': 0.6193586320557073,\n",
       "  'service/test/accuracy': 0.7190666780209487,\n",
       "  'service/test/bal_accuracy': 0.08727071473006094,\n",
       "  'hostname/test/auc': 0.6404705581535092,\n",
       "  'hostname/test/accuracy': 0.21545037201203102,\n",
       "  'hostname/test/bal_accuracy': 0.16973930145704288,\n",
       "  'dns_alias/test/auc': 0.48116374589762206,\n",
       "  'dns_alias/test/accuracy': 0.5256603773584906,\n",
       "  'dns_alias/test/bal_accuracy': 0.3502140343053888,\n",
       "  'hardware/test/auc': 0.6963469542604255,\n",
       "  'hardware/test/accuracy': 0.3151812569257559,\n",
       "  'hardware/test/bal_accuracy': 0.27417038278277867,\n",
       "  'opsys/test/auc': 0.6363547918913738,\n",
       "  'opsys/test/accuracy': 0.25280199252801994,\n",
       "  'opsys/test/bal_accuracy': 0.1633632049027,\n",
       "  'ALL/test/auc': 0.7411571210046265,\n",
       "  'ALL/test/accuracy': 0.6489091591707347,\n",
       "  'ALL/test/bal_accuracy': 0.3677923030589538}]"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "from lightning import Trainer\n",
    "from lightning.pytorch.callbacks import EarlyStopping, LearningRateMonitor, ModelCheckpoint\n",
    "from lightning.pytorch.loggers import TensorBoardLogger\n",
    "\n",
    "# pl.seed_everything(42)\n",
    "max_epochs = 50\n",
    "early_stoping_callback = EarlyStopping(\n",
    "    monitor=\"val/loss\", min_delta=1e-5, patience=max_epochs // 5, verbose=False, mode=\"min\"\n",
    ")\n",
    "model_checkpoint_callback = ModelCheckpoint(\n",
    "    monitor=\"val/loss\",\n",
    "    mode=\"min\",\n",
    "    save_last=True,\n",
    "    # save_top_k=1\n",
    ")\n",
    "lr_logger = LearningRateMonitor()\n",
    "log_dir = f\"runs/tagging/{model_name}/{'dev' if IS_LOCAL else 'prod'}\"\n",
    "tb_logger = TensorBoardLogger(log_dir)\n",
    "\n",
    "trainer = Trainer(\n",
    "    # gpus=None,\n",
    "    max_epochs=max_epochs,\n",
    "    # min_epochs=5,\n",
    "    enable_model_summary=True,\n",
    "    callbacks=[lr_logger, early_stoping_callback, model_checkpoint_callback],\n",
    "    logger=tb_logger,\n",
    "    gradient_clip_val=5.0,\n",
    "    # max_steps=300,\n",
    "    # fast_dev_run=True\n",
    ")\n",
    "trainer.fit(\n",
    "    model=model,\n",
    "    train_dataloaders=train_loader,\n",
    "    val_dataloaders=val_loader,\n",
    ")\n",
    "trainer.test(\n",
    "    model,\n",
    "    ckpt_path=\"best\",\n",
    "    dataloaders=test_loader,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Inference with pre-trained models"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{'group_ids': ['group_id'], 'time_idx': 'time_idx_nogap', 'min_encoder_length': 0, 'max_encoder_length': 0, 'min_decoder_length': 1, 'max_decoder_length': 10, 'encoder_variables': [], 'decoder_variables': ['totDataBytes', 'client_bytes', 'server_bytes', 'network_packets', 'source_packets', 'destination_packets', 'network_bytes', 'source_bytes', 'destination_bytes', 'hour_sin', 'hour_cos', 'minute_sin', 'minute_cos', 'second_sin', 'second_cos', 'microsecond_sin', 'microsecond_cos', 'ipProtocol', 'protocol', 'source_geo_country_iso_code', 'destination_geo_country_iso_code', 'has_dns_host', 'has_cert'], 'targets': ['is_private', 'is_global', 'is_unspecified', 'is_link_local', 'is_red_team', 'blue_team', 'facility', 'service', 'hostname', 'dns_alias', 'hardware', 'opsys'], 'static_variables': [], 'training': True, 'random_length': True, 'scalers': {'ipProtocol': NaNLabelEncoder, 'source_geo_country_iso_code': NaNLabelEncoder, 'protocol': NaNLabelEncoder, 'has_dns_host': NaNLabelEncoder, 'destination_geo_country_iso_code': NaNLabelEncoder, 'has_cert': NaNLabelEncoder, 'second_cos': StandardScaler(), 'client_bytes': StandardScaler(), 'minute_cos': StandardScaler(), 'microsecond_sin': StandardScaler(), 'totDataBytes': StandardScaler(), 'network_packets': StandardScaler(), 'hour_cos': StandardScaler(), 'network_bytes': StandardScaler(), 'second_sin': StandardScaler(), 'source_bytes': StandardScaler(), 'minute_sin': StandardScaler(), 'destination_bytes': StandardScaler(), 'source_packets': StandardScaler(), 'microsecond_cos': StandardScaler(), 'server_bytes': StandardScaler(), 'destination_packets': StandardScaler(), 'hour_sin': StandardScaler()}, 'target_normalizers': {'is_private': LabelEncoder(), 'is_global': LabelEncoder(), 'is_unspecified': LabelEncoder(), 'is_link_local': LabelEncoder(), 'is_red_team': LabelEncoder(), 'blue_team': LabelEncoder(), 'facility': LabelEncoder(), 'service': LabelEncoder(), 'hostname': LabelEncoder(), 'dns_alias': LabelEncoder(), 'hardware': LabelEncoder(), 'opsys': LabelEncoder()}, 'imputers': None, 'add_na': False, 'ignore_na': False, 'allow_missing_time_steps': True, 'unknown_value': nan, 'non_overlapped_windows': False, 'return_missing_mask': False}\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Indexing - step 2/2: 100%|██████████| 1/1 [00:11<00:00, 11.78s/it]\n",
      "Indexing - step 1/2: 100%|██████████| 1/1 [00:00<00:00, 27.49it/s]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Finished Indexing in 11.83(s)\n",
      "Missing time steps:  0.00%(0/23502)\n",
      "Preprocessing ...\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "ic| len(test_dataset): 23492\n",
      "ic| len(test_loader): 23492\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Done\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "23492"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import torch\n",
    "from united.models.annotation import LSTMAnnotation, TransformerAnnotation\n",
    "from united.data.timeseries import SensorTimeSeriesDataset\n",
    "\n",
    "if model_name == \"transformer\":\n",
    "    model_path = \"runs/transformer/prod/lightning_logs/version_0/checkpoints/epoch=11-step=108.ckpt\"\n",
    "    model = TransformerAnnotation.load_from_checkpoint(\n",
    "        model_path,\n",
    "        map_location=torch.device(\"cpu\"),\n",
    "    )\n",
    "elif model_name == \"lstm\":\n",
    "    model_path = \"runs/tagging/lstm/dev/lightning_logs/version_21/checkpoints/epoch=2-step=834.ckpt\"\n",
    "    model = LSTMAnnotation.load_from_checkpoint(\n",
    "        model_path,\n",
    "        map_location=torch.device(\"cpu\"),\n",
    "    )\n",
    "else:\n",
    "    raise ValueError(f\"Unknown {model_name} model name\")\n",
    "\n",
    "\n",
    "model.eval()\n",
    "print(model.dataset_params)\n",
    "test_dataset = TimeSeriesDataset.from_parameters(model.dataset_params, X_test, training=False, ignore_na=True)\n",
    "\n",
    "batch_size = 1\n",
    "num_workers = 0\n",
    "\n",
    "test_loader = test_dataset.to_dataloader(batch_size=batch_size, shuffle=True)\n",
    "\n",
    "it_ = iter(test_loader)\n",
    "\n",
    "ic(len(test_dataset))\n",
    "ic(len(test_loader))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "ic| predictions: {'blue_team': tensor([[6, 4, 4, 4, 4, 4, 4, 4, 4, 4]]),\n",
      "                  'dns_alias': tensor([[2, 2, 2, 2, 2, 2, 2, 2, 2, 0]]),\n",
      "                  'facility': tensor([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]]),\n",
      "                  'hardware': tensor([[4, 4, 4, 4, 4, 4, 4, 4, 4, 4]]),\n",
      "                  'hostname': tensor([[ 3, 11,  3,  8,  8,  8,  8,  8,  8,  8]]),\n",
      "                  'is_global': tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]),\n",
      "                  'is_link_local': tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]),\n",
      "                  'is_private': tensor([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]]),\n",
      "                  'is_red_team': tensor([[0, 0, 0, 0, 0, 1, 1, 1, 1, 1]]),\n",
      "                  'is_unspecified': tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]),\n",
      "                  'opsys': tensor([[ 9,  9,  9,  9,  9,  9,  9,  9, 10,  9]]),\n",
      "                  'service': tensor([[13, 13, 13, 13, 13, 13, 13, 13, 13, 13]])}\n",
      "    true_predictions: {'blue_team': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]]),\n",
      "                       'dns_alias': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]]),\n",
      "                       'facility': tensor([[1., 1., 1., 1., 1., 1., 1., 1., nan, 1.]]),\n",
      "                       'hardware': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]]),\n",
      "                       'hostname': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]]),\n",
      "                       'is_global': tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),\n",
      "                       'is_link_local': tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),\n",
      "                       'is_private': tensor([[1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]]),\n",
      "                       'is_red_team': tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),\n",
      "                       'is_unspecified': tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),\n",
      "                       'opsys': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]]),\n",
      "                       'service': tensor([[13., 13., 13., 13., 13., 13., 13., 13., 13., 13.]])}\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "({'is_private': tensor([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]]),\n",
       "  'is_global': tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]),\n",
       "  'is_unspecified': tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]),\n",
       "  'is_link_local': tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]),\n",
       "  'is_red_team': tensor([[0, 0, 0, 0, 0, 1, 1, 1, 1, 1]]),\n",
       "  'blue_team': tensor([[6, 4, 4, 4, 4, 4, 4, 4, 4, 4]]),\n",
       "  'facility': tensor([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]]),\n",
       "  'service': tensor([[13, 13, 13, 13, 13, 13, 13, 13, 13, 13]]),\n",
       "  'hostname': tensor([[ 3, 11,  3,  8,  8,  8,  8,  8,  8,  8]]),\n",
       "  'dns_alias': tensor([[2, 2, 2, 2, 2, 2, 2, 2, 2, 0]]),\n",
       "  'hardware': tensor([[4, 4, 4, 4, 4, 4, 4, 4, 4, 4]]),\n",
       "  'opsys': tensor([[ 9,  9,  9,  9,  9,  9,  9,  9, 10,  9]])},\n",
       " {'is_private': tensor([[1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]]),\n",
       "  'is_global': tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),\n",
       "  'is_unspecified': tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),\n",
       "  'is_link_local': tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),\n",
       "  'is_red_team': tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),\n",
       "  'blue_team': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]]),\n",
       "  'facility': tensor([[1., 1., 1., 1., 1., 1., 1., 1., nan, 1.]]),\n",
       "  'service': tensor([[13., 13., 13., 13., 13., 13., 13., 13., 13., 13.]]),\n",
       "  'hostname': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]]),\n",
       "  'dns_alias': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]]),\n",
       "  'hardware': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]]),\n",
       "  'opsys': tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]])})"
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "x, y = next(it_)\n",
    "predictions = model.predict(x)\n",
    "\n",
    "y = model.construct_output(y)\n",
    "true_predictions = model.tensor_to_predictions(y)\n",
    "ic(predictions, true_predictions)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "graphic",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.11"
  },
  "orig_nbformat": 4
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
